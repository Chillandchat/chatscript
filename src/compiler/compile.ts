import fs from "fs";

import { TreeNode } from "../utils";
import readFile from "../utils/readFile";
import parse from "./parse";

/**
 * This is the compile function, this function will compile the source code given in the 3rd argument.
 * @note This function has no arguments.
 */

const compile = (): void => {
  const ast: Array<TreeNode> = parse(String(readFile(process.argv[2])));

  fs.writeFileSync(
    `${process.argv[process.argv.length - 1].slice(0, process.argv[process.argv.length - 1].length - 5)}.out.chat`,
    `This file is automatically generated, DO NOT EDIT DIRECTLY!! \n${Buffer.from(
      JSON.stringify(ast)
    ).toString("base64")}`
  );
};

export default compile;
